# PentestPro — Penetration Testing Workflow & Reporting

An end‑to‑end penetration testing assistant. Backend exposes a FastAPI + MongoDB API with JWT auth, user roles, reusable assessment templates, guided multi‑step assessments, and rich report generation (Markdown to PDF via WeasyPrint + Jinja2). Frontend is a modern React app (CRACO + Tailwind + shadcn/ui).

## Overview
- Backend: FastAPI, Motor (MongoDB), bcrypt password hashing, JWT (Bearer)
- Domains: Templates (steps/fields), Assessments (status/data), Reports (Markdown → PDF)
- Utilities: Jinja2 templating, Markdown rendering, PDF via WeasyPrint
- Frontend: CRA + CRACO, TailwindCSS, shadcn/ui

Repository paths:
- `backend/` — FastAPI app (`server.py`), requirements
- `frontend/` — CRA app with CRACO, Tailwind config, components and pages

## Requirements
- Python 3.12+
- Node.js 18+ (Frontend)
- MongoDB instance

## Backend Setup
1. Create `.env` in `backend/`:
   ```env
   MONGO_URL=mongodb://localhost:27017
   DB_NAME=pentestpro
   CORS_ORIGINS=http://localhost:3000
   SECRET_KEY=change-me
   ```
2. Install and run:
   ```bash
   cd backend
   python -m venv .venv
   .venv\Scripts\activate  # Windows
   pip install -r requirements.txt
   uvicorn server:app --reload --port 8000
   ```

## Frontend Setup
```bash
cd frontend
yarn install  # or npm install
yarn start    # CRACO dev server at http://localhost:3000
```

## Core API (prefix `/api`)

### Auth & Users
- `POST /auth/register` — register user (email, username, password, role?)
- `POST /auth/login` — returns `{ access_token, token_type, expires_in, user }`
- `GET /auth/me` — current user (requires `Authorization: Bearer <token>`)
- `PUT /users/me` — update profile (username, full_name, avatar, org/team)
- `PUT /users/me/settings` — update preferences (theme, notifications, layout…)

### Templates
- `POST /templates` — create template (name, description, category, `steps[]`, `report_structure[]`)
- `GET /templates` — list templates
- `GET /templates/{id}` — fetch template
- `PUT /templates/{id}` — update
- `DELETE /templates/{id}` — delete

Template building blocks:
- `TemplateStep`: ordered steps with `instructions` and `fields[]`
- `TemplateField`: typed field (`text`, `textarea`, `checkbox`, `file`, `select`, `number`, `url`) with optional options
- `ReportSection`: ordered report sections with HTML/Markdown templates

### Assessments
- `POST /assessments` — create from template (`template_id`, name)
- `GET /assessments` — list assessments
- `GET /assessments/{id}` — fetch
- `PUT /assessments/{id}` — update (status/data/current_step)
- `DELETE /assessments/{id}` — delete

Status lifecycle: `draft` → `in_progress` → `completed` (or `archived`)

### Reports
- `POST /reports` — create report (`assessment_id`, markdown content)
- `GET /reports` — list
- `GET /reports/{id}` — fetch
- `DELETE /reports/{id}` — delete
- `GET /reports/{id}/pdf` — generate and stream PDF (Markdown → HTML via markdown2/Jinja2 → PDF via WeasyPrint)

## Example Usage
Register and login:
```bash
curl -X POST http://localhost:8000/api/auth/register ^
  -H "Content-Type: application/json" ^
  -d "{\"email\":\"analyst@example.com\",\"username\":\"analyst\",\"password\":\"secret\"}"

curl -X POST http://localhost:8000/api/auth/login ^
  -H "Content-Type: application/json" ^
  -d "{\"email\":\"analyst@example.com\",\"password\":\"secret\"}"
```

Create a template and assessment:
```bash
set TOKEN=<JWT>
curl -X POST http://localhost:8000/api/templates ^
  -H "Authorization: Bearer %TOKEN%" ^
  -H "Content-Type: application/json" ^
  -d "{\"name\":\"Web App Pentest\",\"description\":\"OWASP-oriented workflow\",\"steps\":[{\"name\":\"Recon\",\"instructions\":\"Gather info\",\"fields\":[{\"label\":\"Targets\",\"type\":\"textarea\"}]}]}"

curl -X POST http://localhost:8000/api/assessments ^
  -H "Authorization: Bearer %TOKEN%" ^
  -H "Content-Type: application/json" ^
  -d "{\"template_id\":\"<TEMPLATE_ID>\",\"name\":\"Acme Q4\"}"
```

Generate report PDF:
```bash
curl -X GET http://localhost:8000/api/reports/<REPORT_ID>/pdf -o report.pdf
```

## Tests
- Extensive API tests: `backend_test.py`, plus expanded suites under repo root
- Run from repo root:
  ```bash
  pytest -q
  ```
- Artifacts: `test_reports/`, summary: `test_result.md`

## Project Structure (excerpt)
```
PentestPro/
├── backend/
│   ├── server.py              # FastAPI app & endpoints (auth, templates, assessments, reports)
│   └── requirements.txt
├── frontend/
│   ├── package.json           # CRA + CRACO + Tailwind + shadcn/ui
│   ├── craco.config.js
│   └── src/
├── backend_test.py            # API tests (+ expanded suites)
├── tests/                     # Additional tests
└── test_reports/              # Test artifacts
```

## Troubleshooting
- Ensure MongoDB is running and env vars (MONGO_URL, DB_NAME, SECRET_KEY, CORS_ORIGINS) are set
- Use a valid Bearer token for protected routes
- For PDF: make sure system dependencies for WeasyPrint are available if you package for production
